<?xml version="1.0" encoding="UTF-8"?>
<entity-facade-xml type="ext-upgrade">
    <moqui.resource.DbResourceFile resourceId="ReturnLineItemByIdQuery">
            <fileData>
                <![CDATA[<#ftl output_format="HTML">
                <@compress single_line=true>
                query{
                    node(id: "${returnId}") {
                        id
                        ... on
                        Return{
                            id
                            returnLineItems (first: 10<#if cursor?has_content>, after: "${cursor}"</#if>) {
                                edges {
                                    node {
                                        ... on ReturnLineItem {
                                            id
                                            returnReason
                                            returnReasonNote
                                            fulfillmentLineItem {
                                                lineItem {
                                                    id
                                                    isGiftCard
                                                    sku
                                                    quantity
                                                    product {
                                                        id
                                                    }
                                                }
                                            }
                                            quantity
                                            withCodeDiscountedTotalPriceSet {
                                                presentmentMoney {
                                                    amount
                                                    currencyCode
                                                }
                                            }
                                        }
                                    }
                                }
                                pageInfo{
                                    endCursor
                                    hasNextPage
                                }
                            }
                        }
                    }
                }
                </@compress>]]>
            </fileData>
    </moqui.resource.DbResourceFile>
    <moqui.resource.DbResourceFile resourceId="RefundLineItemsByIdQuery">
        <fileData>
            <![CDATA[<#ftl output_format="HTML">
                    <@compress single_line=true>
                        query {
                            node(id: "${shopifyRefundId}") {
                                id
                                ... on
                                Refund {
                                    id
                                    refundLineItems (first : 10<#if cursor?has_content>, after: "${cursor}"</#if>) {
                                        edges {
                                            node {
                                                id
                                                lineItem {
                                                    id
                                                    isGiftCard
                                                    variant {
                                                        id
                                                    }
                                                    discountAllocations{
                                                        allocatedAmountSet{
                                                            presentmentMoney{
                                                                amount
                                                                currencyCode
                                                            }
                                                            shopMoney{
                                                                amount
                                                                currencyCode
                                                            }
                                                        }
                                                    }
                                                    taxLines{
                                                        priceSet{
                                                            presentmentMoney{
                                                                amount
                                                                currencyCode
                                                            }
                                                            shopMoney{
                                                                amount
                                                                currencyCode
                                                            }
                                                        }
                                                        rate
                                                        title
                                                    }
                                                }
                                                location {
                                                    id
                                                }
                                                priceSet{
                                                    presentmentMoney{
                                                        amount
                                                        currencyCode
                                                    }
                                                    shopMoney{
                                                        amount
                                                        currencyCode
                                                    }
                                                }
                                                restockType
                                                quantity
                                                subtotalSet{
                                                    presentmentMoney{
                                                        amount
                                                    }
                                                }
                                                totalTaxSet{
                                                    presentmentMoney{
                                                        amount
                                                        currencyCode
                                                    },
                                                    shopMoney{
                                                        currencyCode
                                                        amount
                                                    }
                                                }
                                            }
                                        }
                                        pageInfo {
                                            hasNextPage
                                            endCursor
                                        }
                                    }
                                }
                            }
                        }
                    </@compress>]]>
        </fileData>
    </moqui.resource.DbResourceFile>
    <moqui.service.message.SystemMessageType systemMessageTypeId="ExportOrderReconciliationReport"
                description="Export order reconciliation report to SFTP"
                sendPath="/home/${sftpUsername}/moqui/reconciliation/order/${monthYear}/Order_Reconciliation_${dateTime}.csv"
                sendServiceName="co.hotwax.ofbiz.SystemMessageServices.send#SystemMessageFileSftp"/>
    <!-- SystemMessageType record for generating Order Ids Feed for returns batch processing-->
    <moqui.service.message.SystemMessageType systemMessageTypeId="GenerateOrderIdsFeedForReturnAndCancellation"
                                             description="Generate Order Ids Feed For Returns and Cancellations"
                                             sendPath="component://shopify-connector/template/graphQL/ReturnedOrderIdsQuery.ftl"
                                             sendServiceName="co.hotwax.shopify.system.ShopifySystemMessageServices.generate#ReturnedOrderIdsFeed"
                                             receivePath="${contentRoot}/shopify/OrderIdsFeedForReturnAndCancellation/ReturnedOrderIdsFeed-${dateTime}-${systemMessageId}.json"/>
    <moqui.basic.Enumeration description="Generate Returned Order Ids Feed" enumId="GenerateOrderIdsFeedForReturnAndCancellation" enumTypeId="ShopifyMessageTypeEnum" relatedEnumId="GenerateReturnAndCancellationFeed" relatedEnumTypeId="ShopifyMessageTypeEnum"/>
    <moqui.service.message.SystemMessageType systemMessageTypeId="GenerateReturnAndCancellationFeed"
                                             description="Generate Return and Cancellation Feed"
                                             parentTypeId="LocalFeedFile"
                                             consumeServiceName="co.hotwax.shopify.system.ShopifySystemMessageServices.generate#ReturnAndCancellationFeed"/>
    <!-- ServiceJob data for queuing orderIds feed for returns and cancellation-->
    <moqui.service.job.ServiceJob jobName="queue_ReturnAndCancellationOrderIdsFeed" description="Order Ids Feed for Returns and Cancellations"
                                  serviceName="co.hotwax.shopify.system.ShopifySystemMessageServices.queue#FeedSystemMessage" cronExpression="0 0 * * * ?" paused="Y">
        <parameters parameterName="systemMessageTypeId" parameterValue="GenerateOrderIdsFeedForReturnAndCancellation"/>
        <parameters parameterName="systemMessageRemoteId" parameterValue=""/>
        <parameters parameterName="fromDate" parameterValue=""/>
        <parameters parameterName="thruDate" parameterValue=""/>
        <parameters parameterName="additionalParameters" parameterValue=""/>
        <parameters parameterName="runAsBatch" parameterValue="true"/>
    </moqui.service.job.ServiceJob>

</entity-facade-xml>
